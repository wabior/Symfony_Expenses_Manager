(self["webpackChunk"] = self["webpackChunk"] || []).push([["delete_modal"],{

/***/ "./assets/js/delete_modal.js":
/*!***********************************!*\
  !*** ./assets/js/delete_modal.js ***!
  \***********************************/
/***/ ((module) => {

var deleteExpenseId = null;
var deleteExpenseData = null;
var previousFocusElement = null;

// Function to update modal content dynamically
function updateModalContent() {
  if (!deleteExpenseData) {
    return;
  }

  // Update expense details in modal
  var expenseNameEl = document.querySelector('#deleteModal .expense-name');
  var amountEl = document.querySelector('#deleteModal .expense-amount');
  var dateEl = document.querySelector('#deleteModal .expense-date');
  var recurringWarning = document.querySelector('#deleteModal .recurring-warning');
  if (expenseNameEl) {
    expenseNameEl.textContent = deleteExpenseData.name;
  }
  if (amountEl) {
    amountEl.textContent = "Kwota: ".concat(deleteExpenseData.amount, " z\u0142");
  }
  if (dateEl) {
    dateEl.textContent = "Data: ".concat(deleteExpenseData.date);
  }
  if (recurringWarning) {
    if (deleteExpenseData.isRecurring === 'true') {
      recurringWarning.classList.remove('hidden');
    } else {
      recurringWarning.classList.add('hidden');
    }
  }
}

// Global functions for onclick handlers
window.showDeleteConfirm = function (occurrenceId, expenseName, amount, date, isRecurring) {
  // Store previous focus for accessibility
  previousFocusElement = document.activeElement;
  deleteExpenseId = occurrenceId;
  deleteExpenseData = {
    name: expenseName,
    amount: amount,
    date: date,
    isRecurring: isRecurring
  };

  // Update modal content dynamically
  updateModalContent();

  // Show modal with animation
  var modal = document.getElementById('deleteModal');
  var modalContent = modal.querySelector('.modal-content');
  modal.classList.remove('hidden');
  modal.classList.add('flex');

  // Trigger animation
  setTimeout(function () {
    modalContent.classList.remove('scale-95');
    modalContent.classList.add('scale-100');
  }, 10);

  // Focus management - move focus to modal
  var confirmBtn = document.getElementById('confirmDeleteBtn');
  if (confirmBtn) {
    confirmBtn.focus();
  }

  // Prevent body scroll
  document.body.style.overflow = 'hidden';
};
window.hideDeleteConfirm = function () {
  var modal = document.getElementById('deleteModal');
  var modalContent = modal.querySelector('.modal-content');

  // Animation before hiding
  modalContent.classList.remove('scale-100');
  modalContent.classList.add('scale-95');
  setTimeout(function () {
    modal.classList.add('hidden');
    modal.classList.remove('flex');

    // Restore body scroll
    document.body.style.overflow = '';

    // Restore focus
    if (previousFocusElement) {
      previousFocusElement.focus();
    }
  }, 150);
  deleteExpenseId = null;
  deleteExpenseData = null;
};
window.confirmDelete = function () {
  if (!deleteExpenseId) {
    return;
  }

  // Show loading state
  var confirmBtn = document.getElementById('confirmDeleteBtn');
  if (confirmBtn) {
    confirmBtn.disabled = true;
    confirmBtn.innerHTML = "\n            <span class=\"flex items-center\">\n                <svg class=\"w-4 h-4 mr-2 animate-spin\" fill=\"none\" stroke=\"currentColor\"\n                     viewBox=\"0 0 24 24\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"\n                          d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\n                </svg>\n                Usuwanie...\n            </span>\n        ";
  }

  // Create and submit form with CSRF token
  var form = document.createElement('form');
  form.method = 'POST';
  form.action = "/expenses/delete/".concat(deleteExpenseId);
  form.style.display = 'none';

  // Add CSRF token
  var csrfMeta = document.querySelector('meta[name="csrf-token"]');
  if (csrfMeta && csrfMeta.content) {
    var tokenInput = document.createElement('input');
    tokenInput.type = 'hidden';
    tokenInput.name = '_token';
    tokenInput.value = csrfMeta.content;
    form.appendChild(tokenInput);
  }
  document.body.appendChild(form);
  form.submit();
};

// Keyboard navigation and accessibility
document.addEventListener('DOMContentLoaded', function () {
  // Handle Escape key
  document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape') {
      var _modal = document.getElementById('deleteModal');
      if (!_modal.classList.contains('hidden')) {
        window.hideDeleteConfirm();
      }
    }
  });

  // Handle modal click outside
  var modal = document.getElementById('deleteModal');
  if (modal) {
    modal.addEventListener('click', function (e) {
      if (e.target === this) {
        window.hideDeleteConfirm();
      }
    });

    // Focus trap for accessibility
    modal.addEventListener('keydown', function (e) {
      if (e.key === 'Tab') {
        var focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        var firstElement = focusableElements[0];
        var lastElement = focusableElements[focusableElements.length - 1];
        if (e.shiftKey) {
          // Shift + Tab
          if (document.activeElement === firstElement) {
            e.preventDefault();
            lastElement.focus();
          }
        } else {
          // Tab
          if (document.activeElement === lastElement) {
            e.preventDefault();
            firstElement.focus();
          }
        }
      }
    });
  }

  // Handle Enter key on confirm button (redundant but good UX)
  var confirmBtn = document.getElementById('confirmDeleteBtn');
  if (confirmBtn) {
    confirmBtn.addEventListener('keydown', function (e) {
      if (e.key === 'Enter' && !this.disabled) {
        window.confirmDelete();
      }
    });
  }
});

// Export functions for potential module usage
if ( true && module.exports) {
  module.exports = {
    showDeleteConfirm: showDeleteConfirm,
    hideDeleteConfirm: hideDeleteConfirm,
    confirmDelete: confirmDelete
  };
}

/***/ })

},
/******/ __webpack_require__ => { // webpackRuntimeModules
/******/ var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
/******/ var __webpack_exports__ = (__webpack_exec__("./assets/js/delete_modal.js"));
/******/ }
]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxTQUFTLEVBQUUsVUFBVUMsQ0FBQyxFQUFFO01BQ2hELElBQUlBLENBQUMsQ0FBQ0MsR0FBRyxLQUFLLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQ2hCLFFBQVEsRUFBRTtRQUNyQ2hCLE1BQU0sQ0FBQ2UsYUFBYSxDQUFDLENBQUM7TUFDMUI7SUFDSixDQUFDLENBQUM7RUFDTjtBQUNKLENBQUMsQ0FBQzs7QUFFRjtBQUNBLElBQUksS0FBNkIsSUFBSTJCLE1BQU0sQ0FBQ0MsT0FBTyxFQUFFO0VBQ2pERCxNQUFNLENBQUNDLE9BQU8sR0FBRztJQUNiMUMsaUJBQWlCLEVBQWpCQSxpQkFBaUI7SUFDakJhLGlCQUFpQixFQUFqQkEsaUJBQWlCO0lBQ2pCQyxhQUFhLEVBQWJBO0VBQ0osQ0FBQztBQUNMLEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hc3NldHMvanMvZGVsZXRlX21vZGFsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImxldCBkZWxldGVFeHBlbnNlSWQgPSBudWxsO1xubGV0IGRlbGV0ZUV4cGVuc2VEYXRhID0gbnVsbDtcbmxldCBwcmV2aW91c0ZvY3VzRWxlbWVudCA9IG51bGw7XG5cbi8vIEZ1bmN0aW9uIHRvIHVwZGF0ZSBtb2RhbCBjb250ZW50IGR5bmFtaWNhbGx5XG5mdW5jdGlvbiB1cGRhdGVNb2RhbENvbnRlbnQoKSB7XG4gICAgaWYgKCFkZWxldGVFeHBlbnNlRGF0YSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIGV4cGVuc2UgZGV0YWlscyBpbiBtb2RhbFxuICAgIGNvbnN0IGV4cGVuc2VOYW1lRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZGVsZXRlTW9kYWwgLmV4cGVuc2UtbmFtZScpO1xuICAgIGNvbnN0IGFtb3VudEVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2RlbGV0ZU1vZGFsIC5leHBlbnNlLWFtb3VudCcpO1xuICAgIGNvbnN0IGRhdGVFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkZWxldGVNb2RhbCAuZXhwZW5zZS1kYXRlJyk7XG4gICAgY29uc3QgcmVjdXJyaW5nV2FybmluZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkZWxldGVNb2RhbCAucmVjdXJyaW5nLXdhcm5pbmcnKTtcblxuICAgIGlmIChleHBlbnNlTmFtZUVsKSB7XG4gICAgICAgIGV4cGVuc2VOYW1lRWwudGV4dENvbnRlbnQgPSBkZWxldGVFeHBlbnNlRGF0YS5uYW1lO1xuICAgIH1cbiAgICBpZiAoYW1vdW50RWwpIHtcbiAgICAgICAgYW1vdW50RWwudGV4dENvbnRlbnQgPSBgS3dvdGE6ICR7ZGVsZXRlRXhwZW5zZURhdGEuYW1vdW50fSB6xYJgO1xuICAgIH1cbiAgICBpZiAoZGF0ZUVsKSB7XG4gICAgICAgIGRhdGVFbC50ZXh0Q29udGVudCA9IGBEYXRhOiAke2RlbGV0ZUV4cGVuc2VEYXRhLmRhdGV9YDtcbiAgICB9XG5cbiAgICBpZiAocmVjdXJyaW5nV2FybmluZykge1xuICAgICAgICBpZiAoZGVsZXRlRXhwZW5zZURhdGEuaXNSZWN1cnJpbmcgPT09ICd0cnVlJykge1xuICAgICAgICAgICAgcmVjdXJyaW5nV2FybmluZy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlY3VycmluZ1dhcm5pbmcuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8vIEdsb2JhbCBmdW5jdGlvbnMgZm9yIG9uY2xpY2sgaGFuZGxlcnNcbndpbmRvdy5zaG93RGVsZXRlQ29uZmlybSA9IGZ1bmN0aW9uIChvY2N1cnJlbmNlSWQsIGV4cGVuc2VOYW1lLCBhbW91bnQsIGRhdGUsIGlzUmVjdXJyaW5nKSB7XG4gICAgLy8gU3RvcmUgcHJldmlvdXMgZm9jdXMgZm9yIGFjY2Vzc2liaWxpdHlcbiAgICBwcmV2aW91c0ZvY3VzRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG5cbiAgICBkZWxldGVFeHBlbnNlSWQgPSBvY2N1cnJlbmNlSWQ7XG4gICAgZGVsZXRlRXhwZW5zZURhdGEgPSB7XG4gICAgICAgIG5hbWU6IGV4cGVuc2VOYW1lLFxuICAgICAgICBhbW91bnQsXG4gICAgICAgIGRhdGUsXG4gICAgICAgIGlzUmVjdXJyaW5nXG4gICAgfTtcblxuICAgIC8vIFVwZGF0ZSBtb2RhbCBjb250ZW50IGR5bmFtaWNhbGx5XG4gICAgdXBkYXRlTW9kYWxDb250ZW50KCk7XG5cbiAgICAvLyBTaG93IG1vZGFsIHdpdGggYW5pbWF0aW9uXG4gICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVsZXRlTW9kYWwnKTtcbiAgICBjb25zdCBtb2RhbENvbnRlbnQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWwtY29udGVudCcpO1xuXG4gICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XG4gICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnZmxleCcpO1xuXG4gICAgLy8gVHJpZ2dlciBhbmltYXRpb25cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgbW9kYWxDb250ZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NjYWxlLTk1Jyk7XG4gICAgICAgIG1vZGFsQ29udGVudC5jbGFzc0xpc3QuYWRkKCdzY2FsZS0xMDAnKTtcbiAgICB9LCAxMCk7XG5cbiAgICAvLyBGb2N1cyBtYW5hZ2VtZW50IC0gbW92ZSBmb2N1cyB0byBtb2RhbFxuICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybURlbGV0ZUJ0bicpO1xuICAgIGlmIChjb25maXJtQnRuKSB7XG4gICAgICAgIGNvbmZpcm1CdG4uZm9jdXMoKTtcbiAgICB9XG5cbiAgICAvLyBQcmV2ZW50IGJvZHkgc2Nyb2xsXG4gICAgZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xufTtcblxud2luZG93LmhpZGVEZWxldGVDb25maXJtID0gZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGV0ZU1vZGFsJyk7XG4gICAgY29uc3QgbW9kYWxDb250ZW50ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsLWNvbnRlbnQnKTtcblxuICAgIC8vIEFuaW1hdGlvbiBiZWZvcmUgaGlkaW5nXG4gICAgbW9kYWxDb250ZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3NjYWxlLTEwMCcpO1xuICAgIG1vZGFsQ29udGVudC5jbGFzc0xpc3QuYWRkKCdzY2FsZS05NScpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuICAgICAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdmbGV4Jyk7XG5cbiAgICAgICAgLy8gUmVzdG9yZSBib2R5IHNjcm9sbFxuICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gJyc7XG5cbiAgICAgICAgLy8gUmVzdG9yZSBmb2N1c1xuICAgICAgICBpZiAocHJldmlvdXNGb2N1c0VsZW1lbnQpIHtcbiAgICAgICAgICAgIHByZXZpb3VzRm9jdXNFbGVtZW50LmZvY3VzKCk7XG4gICAgICAgIH1cbiAgICB9LCAxNTApO1xuXG4gICAgZGVsZXRlRXhwZW5zZUlkID0gbnVsbDtcbiAgICBkZWxldGVFeHBlbnNlRGF0YSA9IG51bGw7XG59O1xuXG53aW5kb3cuY29uZmlybURlbGV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoIWRlbGV0ZUV4cGVuc2VJZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gU2hvdyBsb2FkaW5nIHN0YXRlXG4gICAgY29uc3QgY29uZmlybUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtRGVsZXRlQnRuJyk7XG4gICAgaWYgKGNvbmZpcm1CdG4pIHtcbiAgICAgICAgY29uZmlybUJ0bi5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIGNvbmZpcm1CdG4uaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJmbGV4IGl0ZW1zLWNlbnRlclwiPlxuICAgICAgICAgICAgICAgIDxzdmcgY2xhc3M9XCJ3LTQgaC00IG1yLTIgYW5pbWF0ZS1zcGluXCIgZmlsbD1cIm5vbmVcIiBzdHJva2U9XCJjdXJyZW50Q29sb3JcIlxuICAgICAgICAgICAgICAgICAgICAgdmlld0JveD1cIjAgMCAyNCAyNFwiPlxuICAgICAgICAgICAgICAgICAgICA8cGF0aCBzdHJva2UtbGluZWNhcD1cInJvdW5kXCIgc3Ryb2tlLWxpbmVqb2luPVwicm91bmRcIiBzdHJva2Utd2lkdGg9XCIyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZD1cIk00IDR2NWguNTgybTE1LjM1NiAyQTguMDAxIDguMDAxIDAgMDA0LjU4MiA5bTAgMEg5bTExIDExdi01aC0uNTgxbTAgMGE4LjAwMyA4LjAwMyAwIDAxLTE1LjM1Ny0ybTE1LjM1NyAySDE1XCIvPlxuICAgICAgICAgICAgICAgIDwvc3ZnPlxuICAgICAgICAgICAgICAgIFVzdXdhbmllLi4uXG4gICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgIGA7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGFuZCBzdWJtaXQgZm9ybSB3aXRoIENTUkYgdG9rZW5cbiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZm9ybScpO1xuICAgIGZvcm0ubWV0aG9kID0gJ1BPU1QnO1xuICAgIGZvcm0uYWN0aW9uID0gYC9leHBlbnNlcy9kZWxldGUvJHtkZWxldGVFeHBlbnNlSWR9YDtcbiAgICBmb3JtLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cbiAgICAvLyBBZGQgQ1NSRiB0b2tlblxuICAgIGNvbnN0IGNzcmZNZXRhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWV0YVtuYW1lPVwiY3NyZi10b2tlblwiXScpO1xuICAgIGlmIChjc3JmTWV0YSAmJiBjc3JmTWV0YS5jb250ZW50KSB7XG4gICAgICAgIGNvbnN0IHRva2VuSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgICAgICB0b2tlbklucHV0LnR5cGUgPSAnaGlkZGVuJztcbiAgICAgICAgdG9rZW5JbnB1dC5uYW1lID0gJ190b2tlbic7XG4gICAgICAgIHRva2VuSW5wdXQudmFsdWUgPSBjc3JmTWV0YS5jb250ZW50O1xuICAgICAgICBmb3JtLmFwcGVuZENoaWxkKHRva2VuSW5wdXQpO1xuICAgIH1cblxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZm9ybSk7XG4gICAgZm9ybS5zdWJtaXQoKTtcbn07XG5cbi8vIEtleWJvYXJkIG5hdmlnYXRpb24gYW5kIGFjY2Vzc2liaWxpdHlcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgLy8gSGFuZGxlIEVzY2FwZSBrZXlcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKGUua2V5ID09PSAnRXNjYXBlJykge1xuICAgICAgICAgICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVsZXRlTW9kYWwnKTtcbiAgICAgICAgICAgIGlmICghbW9kYWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRkZW4nKSkge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5oaWRlRGVsZXRlQ29uZmlybSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBIYW5kbGUgbW9kYWwgY2xpY2sgb3V0c2lkZVxuICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGV0ZU1vZGFsJyk7XG4gICAgaWYgKG1vZGFsKSB7XG4gICAgICAgIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGlmIChlLnRhcmdldCA9PT0gdGhpcykge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5oaWRlRGVsZXRlQ29uZmlybSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBGb2N1cyB0cmFwIGZvciBhY2Nlc3NpYmlsaXR5XG4gICAgICAgIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgKGUua2V5ID09PSAnVGFiJykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZvY3VzYWJsZUVsZW1lbnRzID0gbW9kYWwucXVlcnlTZWxlY3RvckFsbChcbiAgICAgICAgICAgICAgICAgICAgJ2J1dHRvbiwgW2hyZWZdLCBpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYSwgW3RhYmluZGV4XTpub3QoW3RhYmluZGV4PVwiLTFcIl0pJ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlyc3RFbGVtZW50ID0gZm9jdXNhYmxlRWxlbWVudHNbMF07XG4gICAgICAgICAgICAgICAgY29uc3QgbGFzdEVsZW1lbnQgPSBmb2N1c2FibGVFbGVtZW50c1tmb2N1c2FibGVFbGVtZW50cy5sZW5ndGggLSAxXTtcblxuICAgICAgICAgICAgICAgIGlmIChlLnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFNoaWZ0ICsgVGFiXG4gICAgICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSBmaXJzdEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RFbGVtZW50LmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBUYWJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IGxhc3RFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaXJzdEVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gSGFuZGxlIEVudGVyIGtleSBvbiBjb25maXJtIGJ1dHRvbiAocmVkdW5kYW50IGJ1dCBnb29kIFVYKVxuICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybURlbGV0ZUJ0bicpO1xuICAgIGlmIChjb25maXJtQnRuKSB7XG4gICAgICAgIGNvbmZpcm1CdG4uYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZS5rZXkgPT09ICdFbnRlcicgJiYgIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuY29uZmlybURlbGV0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59KTtcblxuLy8gRXhwb3J0IGZ1bmN0aW9ucyBmb3IgcG90ZW50aWFsIG1vZHVsZSB1c2FnZVxuaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgICAgIHNob3dEZWxldGVDb25maXJtLFxuICAgICAgICBoaWRlRGVsZXRlQ29uZmlybSxcbiAgICAgICAgY29uZmlybURlbGV0ZVxuICAgIH07XG59XG4iXSwibmFtZXMiOlsiZGVsZXRlRXhwZW5zZUlkIiwiZGVsZXRlRXhwZW5zZURhdGEiLCJwcmV2aW91c0ZvY3VzRWxlbWVudCIsInVwZGF0ZU1vZGFsQ29udGVudCIsImV4cGVuc2VOYW1lRWwiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJhbW91bnRFbCIsImRhdGVFbCIsInJlY3VycmluZ1dhcm5pbmciLCJ0ZXh0Q29udGVudCIsIm5hbWUiLCJjb25jYXQiLCJhbW91bnQiLCJkYXRlIiwiaXNSZWN1cnJpbmciLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJhZGQiLCJ3aW5kb3ciLCJzaG93RGVsZXRlQ29uZmlybSIsIm9jY3VycmVuY2VJZCIsImV4cGVuc2VOYW1lIiwiYWN0aXZlRWxlbWVudCIsIm1vZGFsIiwiZ2V0RWxlbWVudEJ5SWQiLCJtb2RhbENvbnRlbnQiLCJzZXRUaW1lb3V0IiwiY29uZmlybUJ0biIsImZvY3VzIiwiYm9keSIsInN0eWxlIiwib3ZlcmZsb3ciLCJoaWRlRGVsZXRlQ29uZmlybSIsImNvbmZpcm1EZWxldGUiLCJkaXNhYmxlZCIsImlubmVySFRNTCIsImZvcm0iLCJjcmVhdGVFbGVtZW50IiwibWV0aG9kIiwiYWN0aW9uIiwiZGlzcGxheSIsImNzcmZNZXRhIiwiY29udGVudCIsInRva2VuSW5wdXQiLCJ0eXBlIiwidmFsdWUiLCJhcHBlbmRDaGlsZCIsInN1Ym1pdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwia2V5IiwiY29udGFpbnMiLCJ0YXJnZXQiLCJmb2N1c2FibGVFbGVtZW50cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmaXJzdEVsZW1lbnQiLCJsYXN0RWxlbWVudCIsImxlbmd0aCIsInNoaWZ0S2V5IiwicHJldmVudERlZmF1bHQiLCJtb2R1bGUiLCJleHBvcnRzIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=